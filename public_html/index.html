<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Sign in</title>
</head>
<body>

<h2>Please Log-in:</h2>

<div id=username>
	<label for="username">Username:</label>
	<input id="usernameInput" type="text">
</div>

<div id=password>
	<label for="password">Password:</label>
	<input id="passwordInput" type="password">
</div>

<!-- doesn't do anything when clicked (yet) -->
<button id="login-button">Log-in</button>

<script>

//define the login button element and add functionality to it
let loginButton = document.getElementById("login-button");
//loginButton.addEventListener("click", showGameOptions);
loginButton.addEventListener("click", loginFunc);


function loginFunc(){
	let usernameInput = document.getElementById("usernameInput");
	let passwordInput = document.getElementById("passwordInput");

	fetch("/login", {
		method: "POST",
		headers: {
			"Content-Type": "application/json"
		},
		body: JSON.stringify({
			username: usernameInput.value,
			plaintextPassword: passwordInput.value,
		})
	}).then(function (response) {
		if (response.status === 200) {
			console.log("Success");
			openHomepage();
		} else {
			console.log("Failure");
		}
	});
}

function openHomepage() {
	depositMoney().then(function(data) {
		console.log(data);
		window.open('http://harambeshouseapp-env.eba-3yv4umtj.us-east-1.elasticbeanstalk.com/homePage.html?user='+data.username+'&token='+data.dbToken);
	})
}

function depositMoney(){
	let depositAmount = 0;
	usernameInput = document.getElementById("usernameInput");

	return fetch("/deposit", {
		method: "POST",
		headers: {
			"Content-Type": "application/json"
		},
		body: JSON.stringify({
			deposit: depositAmount,
			username: usernameInput.value
		})
	})
	.then(function(response){
		return response.json();
	})
	.then(function(data) {
		var accountInfo = data;
		return accountInfo;
	});
}

</script>

</body>
</html>